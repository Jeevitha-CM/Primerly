<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primerly – PCR Primer Design Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5aa0;
            --primary-dark: #1e3f73;
            --primary-light: #4a7bc8;
            --accent-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        body { 
            background: #f8fafc; 
            font-family: 'IBM Plex Sans', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
            background-image: url('/static/doodle.png');
            background-repeat: repeat;
            background-size: 320px 320px;
            background-attachment: fixed;
        }
        
        .navbar-dark {
            background-color: var(--primary-color) !important;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .text-primary {
            color: var(--primary-color) !important;
        }
        
        .border-primary {
            border-color: var(--primary-color) !important;
        }
        .score-label { font-size: 1.1em; font-weight: bold; }
        .explanation-list { font-size: 0.95em; }
        .tooltip-inner { max-width: 350px; }
        /* Bottom panels */
        .bottom-panels {
            margin-top: 40px;
        }
        .logo-small {
            height: 28px;
            width: auto;
        }
    </style>
    <script>
        // Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Disable keyboard shortcuts for developer tools
        document.addEventListener('keydown', function(e) {
            // Disable F12 key
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            
            // Disable Ctrl+Shift+I (Developer Tools)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            
            // Disable Ctrl+Shift+J (Console)
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            
            // Disable Ctrl+U (View Source)
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                return false;
            }
            
            // Disable Ctrl+Shift+C (Inspect Element)
            if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                e.preventDefault();
                return false;
            }
        });
        
        // Disable console access
        console.log = function() {};
        console.info = function() {};
        console.warn = function() {};
        console.error = function() {};
        console.debug = function() {};
        
        // Disable alert override attempts
        window.alert = function() {};
        
        // Disable eval
        window.eval = function() {};
        
        // Disable Function constructor
        window.Function = function() {};
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-dna me-2"></i>Primerly
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a class="nav-link active" href="/">Home</a>
                    <a class="nav-link" href="/about">About Primerly</a>
                    <a class="nav-link" href="/learn">Learn</a>
                </div>
            </div>
        </div>
    </nav>

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="text-center mb-4">
                <h1 class="display-5 fw-bold">Primerly</h1>
                <p class="lead">Beginner-friendly PCR primer design and learning tool</p>
                <a href="/learn" class="btn btn-outline-info">Learn Primer Design Theory</a>
            </div>
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <form id="primer-form" action="javascript:void(0);">
                        <div class="mb-3">
                            <label for="accession" class="form-label">NCBI Accession Number <span class="text-muted">(optional)</span></label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="accession" placeholder="e.g. NM_000546">
                                <button class="btn btn-outline-secondary" type="button" id="fetch-seq-btn">Fetch Sequence</button>
                            </div>
                            <div class="form-text">Or paste a DNA sequence below.</div>
                        </div>
                        <div class="mb-3">
                            <label for="sequence" class="form-label">DNA Sequence</label>
                            <textarea class="form-control" id="sequence" rows="4" placeholder="Paste your DNA sequence here (A, T, C, G, N only)"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="experiment_type" class="form-label">Experiment Type</label>
                            <select class="form-select" id="experiment_type">
                                <option value="standard_pcr" selected>Standard PCR</option>
                                <option value="qpcr">qPCR (Real-time PCR)</option>
                            </select>
                            <div class="form-text" id="experiment-description">
                                Standard PCR amplifies DNA for analysis. Good for general molecular biology work.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="target_region" class="form-label">Target Region</label>
                            <select class="form-select" id="target_region">
                                <option value="full_gene" selected>Full Gene</option>
                                <option value="cds">CDS (Coding Sequence)</option>
                                <option value="3utr">3' UTR</option>
                                <option value="custom">Custom Coordinates</option>
                            </select>
                            <div class="form-text">Select the region of the gene to target for primer design.</div>
                        </div>
                        <div class="mb-3" id="custom-coords" style="display: none;">
                            <label for="custom_start" class="form-label">Custom Coordinates</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="custom_start" placeholder="Start position">
                                </div>
                                <div class="col-md-6">
                                    <input type="number" class="form-control" id="custom_end" placeholder="End position">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="mode" class="form-label">Mode</label>
                            <select class="form-select" id="mode">
                                <option value="beginner" selected>Beginner Mode</option>
                                <option value="expert">Expert Mode</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Design Primers</button>
                    </form>
                </div>
            </div>
            <div id="error-message" class="alert alert-danger d-none"></div>
            
            <!-- Bottom panels for Early Access and Upcoming Features -->
            <div class="bottom-panels">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h6 class="mb-2">Early Access</h6>
                                <p class="small mb-2"><strong>First 1,000 users</strong> get discount and advanced features.</p>
                                <button class="btn btn-sm btn-success w-100" data-bs-toggle="modal" data-bs-target="#earlyAccessModal">Join Early Access</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h6 class="mb-2">Upcoming Features</h6>
                                <p class="small mb-2">Interested in ordering primers when we launch?</p>
                                <div class="d-flex align-items-center mb-2">
                                    <button id="interest-btn" class="btn btn-sm btn-outline-primary me-2">I'd order</button>
                                    <span class="small text-muted">Interest: <span id="interest-count">0</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="text-center text-muted mt-4">
                <p>
                    <img src="/static/logo.png" alt="Biovagon" class="logo-small me-2">
                    &copy; 2025 Primerly - A Biovagon Initiative | Version 1.0.0 | MIT License
                </p>
                <p class="small">
                    <a href="/learn" class="text-decoration-none">Learn More</a> | 
                    <a href="/version" class="text-decoration-none">Version Info</a> |
                    <a href="https://www.biovagon.org/" target="_blank" class="text-decoration-none">Biovagon</a> |
                    <span class="text-muted">Primer Designs: <span id="design-count">—</span></span>
                </p>
            </footer>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const form = document.getElementById('primer-form');
const accessionInput = document.getElementById('accession');
const fetchSeqBtn = document.getElementById('fetch-seq-btn');
const sequenceInput = document.getElementById('sequence');
const experimentTypeSelect = document.getElementById('experiment_type');
const experimentDescription = document.getElementById('experiment-description');
const targetRegionSelect = document.getElementById('target_region');
const customCoords = document.getElementById('custom-coords');
const modeSelect = document.getElementById('mode');
const errorMessage = document.getElementById('error-message');

function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.classList.remove('d-none');
}
function clearError() {
    errorMessage.classList.add('d-none');
}

// Experiment type descriptions
const experimentDescriptions = {
    'standard_pcr': 'Standard PCR amplifies DNA for analysis. Good for general molecular biology work. Targets 200-1000 bp amplicons.',
    'qpcr': 'qPCR (Real-time PCR) measures gene expression in real-time. Automatically targets 3\' UTR region with small amplicons (<200 bp) for accurate quantification.'
};

// Update experiment description when selection changes
experimentTypeSelect.addEventListener('change', () => {
    const selectedType = experimentTypeSelect.value;
    experimentDescription.textContent = experimentDescriptions[selectedType];
    
    // For qPCR, automatically set target region to 3' UTR and disable selection
    if (selectedType === 'qpcr') {
        targetRegionSelect.value = '3utr';
        targetRegionSelect.disabled = true;
        targetRegionSelect.style.backgroundColor = '#e9ecef';
        // Hide custom coordinates if they were shown
        customCoords.style.display = 'none';
    } else {
        targetRegionSelect.disabled = false;
        targetRegionSelect.style.backgroundColor = '';
        // Reset to full gene for standard PCR
        targetRegionSelect.value = 'full_gene';
    }
});

fetchSeqBtn.addEventListener('click', async () => {
    const accession = accessionInput.value.trim();
    if (!accession) {
        showError('Please enter an accession number.');
        return;
    }
    fetchSeqBtn.disabled = true;
    fetchSeqBtn.textContent = 'Fetching...';
    clearError();
    try {
        const res = await fetch('/fetch-sequence', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ accession })
        });
        const data = await res.json();
        if (data.error) {
            showError(data.error);
            sequenceInput.value = '';
        } else {
            sequenceInput.value = data.sequence;
            sequenceInput.readOnly = true;
            clearError();
        }
    } catch (e) {
        showError('Failed to fetch sequence.');
    }
    fetchSeqBtn.disabled = false;
    fetchSeqBtn.textContent = 'Fetch Sequence';
});

accessionInput.addEventListener('input', () => {
    if (!accessionInput.value.trim()) {
        sequenceInput.readOnly = false;
        sequenceInput.value = '';
    }
});

targetRegionSelect.addEventListener('change', () => {
    if (targetRegionSelect.value === 'custom') {
        customCoords.style.display = 'block';
    } else {
        customCoords.style.display = 'none';
    }
});

modeSelect.addEventListener('change', () => {
    // No need to show learn more section as it's removed
});

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearError();
    const sequence = sequenceInput.value.trim();
    const mode = modeSelect.value;
    const experimentType = experimentTypeSelect.value;
    let targetRegion = targetRegionSelect.value;
    const customStart = document.getElementById('custom_start').value;
    const customEnd = document.getElementById('custom_end').value;
    
    // For qPCR, always use 3' UTR as target region
    if (experimentType === 'qpcr') {
        targetRegion = '3utr';
    }
    
    if (!sequence) {
        showError('Please enter a DNA sequence.');
        return;
    }
    try {
        const res = await fetch('/design', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sequence, mode, experiment_type: experimentType, target_region: targetRegion, custom_start: customStart, custom_end: customEnd })
        });
        const data = await res.json();
        if (data.error) {
            showError(data.error);
            return;
        }
        // Redirect to results page
        if (data.redirect) {
            window.location.href = data.redirect;
        }
    } catch (e) {
        showError('Failed to design primers.');
    }
});

// Real-time analytics system
let analyticsInterval;

// Load stats function
async function loadStats() {
    try {
        const res = await fetch('/stats');
        const data = await res.json();
        if (data && !data.error) {
            const dc = document.getElementById('design-count');
            const ic = document.getElementById('interest-count');
            if (dc) dc.textContent = data.primer_designs ?? '0';
            if (ic) ic.textContent = data.order_interest ?? '0';
            return data;
        }
    } catch (error) {
        console.log('Analytics load failed:', error);
    }
    return { primer_designs: 0, order_interest: 0 };
}

// Start real-time analytics refresh
function startAnalyticsRefresh() {
    // Load immediately
    loadStats();
    
    // Then refresh every 3 seconds for real-time updates
    analyticsInterval = setInterval(loadStats, 3000);
}

// Stop analytics refresh (for cleanup)
function stopAnalyticsRefresh() {
    if (analyticsInterval) {
        clearInterval(analyticsInterval);
        analyticsInterval = null;
    }
}

// Initialize analytics on page load
document.addEventListener('DOMContentLoaded', startAnalyticsRefresh);

// Cleanup on page unload
window.addEventListener('beforeunload', stopAnalyticsRefresh);

// Interest button
const interestBtn = document.getElementById('interest-btn');
if (interestBtn) {
    interestBtn.addEventListener('click', async () => {
        try {
            const res = await fetch('/order-interest', { method: 'POST' });
            const data = await res.json();
            if (data && !data.error) {
                // Update immediately
                const ic = document.getElementById('interest-count');
                if (ic) ic.textContent = data.order_interest ?? '0';
                interestBtn.disabled = true;
                interestBtn.textContent = 'Thanks!';
                
                // Refresh all analytics to sync across pages
                loadStats();
            }
        } catch {}
    });
}

</script>

<!-- Early Access Modal -->
<div class="modal fade" id="earlyAccessModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Join Early Access</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <h4 class="text-primary">🌟 Be Among the First 1,000 Users!</h4>
          <p class="mb-3">Join our early access community and unlock exclusive perks:</p>
          <div class="text-start">
            <p class="mb-2">💸 <strong>Special discounts</strong> on primer orders (delivered within 5–10 days)</p>
            <p class="mb-2">⚙️ <strong>Advanced features</strong> and priority support</p>
            <p class="mb-2">🚀 <strong>Early access</strong> to new Biovagon tools and updates</p>
            <p class="mb-3">💬 <strong>Share your opinions</strong> — help shape Primerly's next generation</p>
            <p class="small text-muted">✨ Your feedback drives innovation. Join today and be part of Biovagon's first 1,000 researchers!</p>
          </div>
        </div>
        
        <div class="mb-3">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" id="ea-name" placeholder="Your name">
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="ea-email" placeholder="you@example.com">
        </div>
        <div class="mb-3">
          <label class="form-label">Phone (optional)</label>
          <input type="text" class="form-control" id="ea-phone" placeholder="Optional">
        </div>
        <div id="ea-error" class="text-danger small d-none"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="ea-submit">Join</button>
      </div>
    </div>
  </div>
  <script>
    const eaError = document.getElementById('ea-error');
    document.getElementById('ea-submit')?.addEventListener('click', async () => {
      eaError?.classList.add('d-none');
      const name = document.getElementById('ea-name').value.trim();
      const email = document.getElementById('ea-email').value.trim();
      const phone = document.getElementById('ea-phone').value.trim();
      try {
        const res = await fetch('/early-access', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, phone })
        });
        const data = await res.json();
        if (data.error) {
          eaError.textContent = data.error;
          eaError.classList.remove('d-none');
          return;
        }
        const modal = bootstrap.Modal.getInstance(document.getElementById('earlyAccessModal'));
        modal?.hide();
      } catch (e) {
        eaError.textContent = 'Failed to submit. Please try again.';
        eaError.classList.remove('d-none');
      }
    });
  </script>
</div>
</script>
</body>
</html> 